(()=>{"use strict";const e="pressed",t="released",s={};window.addEventListener("keydown",(t=>{const i=t.code;s[i]=e})),window.addEventListener("keyup",(e=>{const i=e.code;s[i]=t}));class i{static isPressed(t){return s[t]===e}static isReleased(e){return s[e]===t}constructor(e){this.key=e}isPressed(){return i.isPressed(this.key)}isReleased(){return i.isReleased(this.key)}}class n{constructor(e,t){this.x=e,this.y=t,this.visible=!0}update(){}draw(e){}}const r=(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e),o=()=>"ontouchstart"in window||navigator.maxTouchPoints,h=(e,t,s)=>({x:e*s*8,y:t*s*8}),a=["","#23d57d","#11804b","#084b2a","#8f4613","#cb651b","#522a07","#6e7679"],l={TREE:[[0,0,1,1,2,2,0,0],[0,1,2,2,2,2,2,0],[1,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,0],[3,3,2,3,3,2,2,3],[0,3,3,4,4,3,3,0],[0,0,4,4,4,4,0,0],[0,4,4,4,4,4,4,0]],OAK:[[0,0,5,5,5,4,0,0],[0,5,5,4,4,4,4,0],[0,4,4,4,4,4,4,0],[0,4,4,4,4,4,4,0],[0,4,4,6,6,4,6,0],[0,0,6,7,7,6,0,0],[0,0,0,7,7,0,0,0],[0,0,0,7,7,0,0,0]]},c={UP:1,RIGHT:2,DOWN:4,LEFT:8},d={[c.UP]:c.DOWN,[c.RIGHT]:c.LEFT,[c.DOWN]:c.UP,[c.LEFT]:c.RIGHT},u={[c.UP]:[-1,0],[c.RIGHT]:[0,1],[c.DOWN]:[1,0],[c.LEFT]:[0,-1]},T=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[3,3,3,3,3,3,3,3],[3,1,1,1,3,1,1,1],[1,1,1,3,1,1,1,3],[3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],p=[[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0],[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0]];class E extends n{static TYPES={HORIZONTAL:0,VERTICAL:1,LEFTTOP:2,RIGHTTOP:3,LEFTBOTTOM:4,RIGHTBOTTOM:5,UP:6,RIGHT:7,DOWN:8,LEFT:9};static ENDPOINT_TYPES=[E.TYPES.UP,E.TYPES.RIGHT,E.TYPES.DOWN,E.TYPES.LEFT];static ENDPOINT_TYPES_TO_TYPES={[E.TYPES.UP]:E.TYPES.VERTICAL,[E.TYPES.RIGHT]:E.TYPES.HORIZONTAL,[E.TYPES.DOWN]:E.TYPES.VERTICAL,[E.TYPES.LEFT]:E.TYPES.HORIZONTAL};static DIRECTION_TO_TYPE={[""+c.UP+c.RIGHT]:E.TYPES.LEFTTOP,[""+c.UP+c.LEFT]:E.TYPES.RIGHTTOP,[""+c.RIGHT+c.DOWN]:E.TYPES.RIGHTTOP,[""+c.RIGHT+c.UP]:E.TYPES.RIGHTBOTTOM,[""+c.DOWN+c.LEFT]:E.TYPES.RIGHTBOTTOM,[""+c.DOWN+c.RIGHT]:E.TYPES.LEFTBOTTOM,[""+c.LEFT+c.UP]:E.TYPES.LEFTBOTTOM,[""+c.LEFT+c.DOWN]:E.TYPES.LEFTTOP};static COLORS=["","Green","Black","DarkGreen","Pink"];static PIXEL_DATAS={[E.TYPES.HORIZONTAL]:T,[E.TYPES.RIGHT]:T,[E.TYPES.LEFT]:T,[E.TYPES.VERTICAL]:p,[E.TYPES.UP]:p,[E.TYPES.DOWN]:p,[E.TYPES.LEFTTOP]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,3,3,3,3],[0,0,0,3,3,1,1,1],[0,0,3,3,1,1,1,3],[0,0,3,1,1,1,3,3],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0]],[E.TYPES.RIGHTTOP]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[3,3,3,3,0,0,0,0],[3,1,1,1,3,0,0,0],[1,1,1,3,1,3,0,0],[3,3,1,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0]],[E.TYPES.LEFTBOTTOM]:[[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,1,3,3],[0,0,3,1,3,1,1,1],[0,0,0,3,1,1,1,3],[0,0,0,0,3,3,3,3],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],[E.TYPES.RIGHTBOTTOM]:[[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[3,3,1,1,1,3,0,0],[3,1,1,1,3,3,0,0],[1,1,1,3,3,0,0,0],[3,3,3,3,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]]};constructor(e,t,s,i){super(e,t),this.pixelSize=s,this.type=i||E.TYPES.HORIZONTAL}update(){}draw(e){const{pixelSize:t,type:s}=this,{x:i,y:n}=h(this.x,this.y,t),r=this._getPixelData(s);for(let s=0;s<r.length;s++)for(let o=0;o<r[s].length;o++)0!==r[s][o]&&e.drawRect(i+o*t,n+s*t,t,t,this._getColor(r[s][o]))}_getPixelData(e){return E.PIXEL_DATAS[e]}_getColor(e){return E.COLORS[e]}}class v extends E{static DIRECTION_TO_TYPE={[c.UP]:E.TYPES.UP,[c.RIGHT]:E.TYPES.RIGHT,[c.DOWN]:E.TYPES.DOWN,[c.LEFT]:E.TYPES.LEFT};static PIXEL_DATAS={[E.TYPES.UP]:[[0,0,0,4,0,0,0,0],[0,0,0,0,4,0,0,0],[0,0,0,3,3,0,0,0],[0,0,3,1,1,3,0,0],[0,0,2,1,1,2,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0]],[E.TYPES.RIGHT]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[3,3,3,3,3,0,0,0],[3,1,1,2,1,3,0,4],[1,1,1,1,1,3,4,0],[3,3,3,3,3,3,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],[E.TYPES.DOWN]:[[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,2,1,1,2,0,0],[0,0,3,1,1,3,0,0],[0,0,0,3,3,0,0,0],[0,0,0,4,0,0,0,0],[0,0,0,0,4,0,0,0]],[E.TYPES.LEFT]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,3,3,3,3,3],[4,0,3,1,2,1,1,1],[0,4,3,1,1,1,1,3],[0,0,3,3,3,3,3,3],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]]};update(){}draw(e){super.draw(e)}_getPixelData(e){return v.PIXEL_DATAS[e]}}class P extends E{static DIRECTION_TO_TYPE={[c.UP]:E.TYPES.UP,[c.RIGHT]:E.TYPES.RIGHT,[c.DOWN]:E.TYPES.DOWN,[c.LEFT]:E.TYPES.LEFT};static PIXEL_DATAS={[E.TYPES.UP]:[[0,0,3,3,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,3,3,3,0,0],[0,0,0,3,3,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],[E.TYPES.RIGHT]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,3,3,3,3,3],[0,0,3,3,1,1,1,1],[0,0,3,3,1,1,1,3],[0,0,0,3,3,3,3,3],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],[E.TYPES.DOWN]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,3,3,0,0,0],[0,0,3,3,3,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,1,3,0,0],[0,0,3,1,3,3,0,0]],[E.TYPES.LEFT]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[3,3,3,3,3,0,0,0],[3,1,1,1,3,3,0,0],[1,1,1,1,3,3,0,0],[3,3,3,3,3,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]]};update(){}draw(e){super.draw(e)}_getPixelData(e){return P.PIXEL_DATAS[e]}}class x{events={};addEventListener(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}removeEventListener(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}on(e,t){this.addEventListener(e,t)}off(e,t){this.removeEventListener(e,t)}once(e,t){const s=()=>{t(),this.removeEventListener(e,s)};this.addEventListener(e,s)}emit(e,...t){this.events[e]&&this.events[e].forEach((e=>e(...t)))}}const w=o()?3:5;class f{constructor(e,t,s){this.value=e,this.next=s||null,this.prev=t||null}}class y extends n{constructor(e){const{length:t,rowNums:s,colNums:i,pixelSize:n}=e;super(0,0),this.length=t,this.rowNums=s,this.colNums=i,this.pixelSize=n,this.direction=c.RIGHT,this.speed=1,this.beforeMove=null,this.head=new f(new v(t,1,n,v.TYPES.RIGHT));let r=this.head;for(let e=1;e<t-1;e++)r.next=new f(new E(t-e,1,n,E.TYPES.HORIZONTAL),r),r=r.next;r.next=new f(new P(1,1,n,P.TYPES.RIGHT),r),r=r.next,this.tail=r,this._elapsed=0,this._canGrow=!1,this._directionQueue=[],this._lastDirection=this.direction,this._eventEmitter=new x,this._dash=0}update(e){this._elapsed+=e;const t=this.beforeMove?16:0;if(this._elapsed>=1e3/(t||this._dash||this.speed)){if(this._elapsed=0,this.beforeMove){const e=!this._canGrow;this.direction=this.beforeMove({isTailAccessible:e})}else this._directionQueue.length>0&&(this._lastDirection=this.direction,this.direction=this._directionQueue.shift());this._canGrow?(this._doGrow(),this._canGrow=!1):this.move()}}draw(e){for(let t=this.tail;t;t=t.prev)t.value.visible&&t.value.draw(e)}move(){for(let e=this.tail;e.prev;e=e.prev)e.value.x=e.prev.value.x,e.value.y=e.prev.value.y,E.ENDPOINT_TYPES.includes(e.prev.value.type)?e.value.type=E.ENDPOINT_TYPES_TO_TYPES[e.prev.value.type]:e.value.type=e.prev.value.type;this.tail.value.type=this._calcTailType();const e=this.head,t=u[this.direction];e.value.x+=t[1],e.value.y+=t[0],e.value.type=v.DIRECTION_TO_TYPE[this.direction],this.direction!==this._lastDirection&&(e.value.type=v.DIRECTION_TO_TYPE[this.direction],e.next.value.type=E.DIRECTION_TO_TYPE[""+this._lastDirection+this.direction],this._lastDirection=this.direction)}dash(){this._dash=10,setTimeout((()=>{this._dash=0}),300)}_calcTailType(){const e=this.tail.value,t=this.tail.prev.value;return e.x===t.x?e.y<t.y?P.TYPES.DOWN:P.TYPES.UP:e.x<t.x?P.TYPES.RIGHT:P.TYPES.LEFT}grow(){this._canGrow=!0}toString(){let e="";for(let t=this.head;t;t=t.next)e+=`[${t.value.x},${t.value.y},${t.value.type}] `;return e}_doGrow(){const e=this.head,t=new f(new E(e.value.x,e.value.y,this.pixelSize,e.value.type),e,e.next);e.next.prev=t,e.next=t,this.length++;const s=u[this.direction];e.value.x+=s[1],e.value.y+=s[0],this.direction!==this._lastDirection&&(e.value.type=v.DIRECTION_TO_TYPE[this.direction],e.next.value.type=E.DIRECTION_TO_TYPE[""+this._lastDirection+this.direction],this._lastDirection=this.direction),this._eventEmitter.emit("statusChanged",this.length,this.speed)}changeDirection(e){if(0===this._directionQueue.length)e!==this.direction&&d[e]!==this.direction&&this._directionQueue.push(e);else{const t=this._directionQueue[this._directionQueue.length-1];e!==t&&d[e]!==t&&this._directionQueue.push(e)}}speedUp(){this.speed=Math.min(this.speed+1,w),this._eventEmitter.emit("statusChanged",this.length,this.speed)}speedDown(){this.speed=Math.max(this.speed-1,1),this._eventEmitter.emit("statusChanged",this.length,this.speed)}isEat(e){const t=this.head;return t.value.x===e.x&&t.value.y===e.y}isDead(){const e=this.head,{x:t,y:s}=e.value;if(t<1||t>this.colNums||s<1||s>this.rowNums)return!0;for(let i=e.next;i;i=i.next)if(i.value.x===t&&i.value.y===s)return!0;return!1}forEach(e){for(let t=this.head;t;t=t.next)e(t.value)}includes(e,t){for(let s=this.head;s;s=s.next)if(s.value.x===e&&s.value.y===t)return!0;return!1}onStatusChanged(e){this._eventEmitter.on("statusChanged",e)}getHead(){return this.head.value}getTail(){return this.tail.value}}const S=["","#59b574","#4e1413","#832525","#bc3532","#e23f40","#e78385","#fceaaa","#f3de70","#cf641e","#f37a2a","#8e4413"],g={0:[[0,0,0,1,0,0,0,0],[0,0,0,0,2,0,0,0],[0,0,3,3,2,3,0,0],[0,3,6,6,2,4,3,0],[0,3,5,5,5,4,3,0],[0,3,4,4,4,4,3,0],[0,0,3,3,3,3,0,0],[0,0,0,0,0,0,0,0]],1:[[0,0,0,0,1,1,1,0],[0,0,0,0,2,1,0,1],[0,0,0,2,0,2,0,0],[0,0,0,2,0,4,4,0],[0,0,3,4,3,5,6,4],[0,3,5,6,3,5,5,4],[0,3,5,5,3,3,3,0],[0,0,3,3,0,0,0,0]],2:[[0,0,0,11,11,11,11,11],[0,0,0,11,7,8,8,11],[0,0,0,0,9,8,11,0],[0,0,0,9,8,8,10,0],[0,0,9,8,8,8,10,0],[9,9,8,8,7,10,0,0],[9,8,8,7,10,0,0,0],[0,9,9,9,0,0,0,0]],3:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[1,6,4,4,2,4,4,1],[1,2,4,4,4,4,4,1],[1,4,4,2,4,4,2,1],[0,1,4,4,4,4,1,0],[0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0]]};class m{constructor(e,t){this.value=e,this.code=t}}class L{constructor(e){this.heap=[],e&&e.length&&this._initHeap(e)}enqueue(e){this.heap.push(e),this.moveUp(this.heap.length-1)}dequeue(){const{heap:e}=this,t=e.shift();if(!this.isEmpty()){const t=e.pop();e.unshift(t),this.moveDown(0)}return t}isEmpty(){return 0===this.heap.length}top(){return this.heap[0]}find(e){const{heap:t}=this;for(let s=0;s<t.length;++s)if(e(t[s]))return t[s];return null}findIndex(e){const{heap:t}=this;for(let s=0;s<t.length;++s)if(e(t[s]))return s;return-1}toString(){return this.heap.map((e=>e.value)).join(", ")}swap(e,t){const{heap:s}=this;[s[e],s[t]]=[s[t],s[e]]}moveUp(e){const{heap:t}=this;for(;0!==e;){const s=Math.floor((e-1)/2);if(!(t[e].code<t[s].code))break;this.swap(s,e),e=s}}moveDown(e){const{heap:t}=this,s=Math.floor((t.length-2)/2);for(;e<=s;){const s=t[2*e+1],i=t[2*e+2]||s,n=s.code<=i.code?s:i,r=s.code<=i.code?2*e+1:2*e+2;if(!(n.code<t[e].code))break;this.swap(r,e),e=r}}_initHeap(e){const{heap:t}=this;t.push(e[0]);for(let s=1;s<e.length;++s)t.unshift(e[s]),this.moveDown(0)}}const O=(e,t,s,i)=>{let n=4*((e,t,s,i)=>Math.abs(e-s)+Math.abs(t-i))(e,t,s,i);return n*=1.001,n},_=(e,t,s,i,n,r)=>{const o=O(e,t,s,i),h=O(s,i,n,r);return{g:o,h,f:o+h}},D=(e,t,s,i,n,r)=>{const{g:o,h,f:a}=_(e,t,s,i,n,r);return new m({x:s,y:i,g:o,h,f:a,parent:null},a)},I=[[-1,0],[0,1],[1,0],[0,-1]],N=(e,t,s,i)=>I.map((([s,i])=>({x:e+i,y:t+s}))).filter((({x:e,y:t})=>e>=0&&t>=0&&e<s.length&&t<s[0].length&&0===s[t][e]&&!i.has(""+e+t))),Y=e=>{const t=[];for(let s=e;s;s=s.parent)t.unshift({x:s.x,y:s.y});return t},R=(e,t,s,i,n)=>{const r=new L,o=new Set,h=D(e,t,e,t,s,i);for(r.enqueue(h);!r.isEmpty();){const h=r.dequeue(),{value:{x:a,y:l}}=h;if(o.add(""+a+l),a===s&&l===i)return Y(h);const c=N(h.value.x,h.value.y,n,o);for(const{x:n,y:o}of c){const c=r.find((e=>e.value.x===n&&e.value.y===o));if(c){const{g:a,f:l}=_(e,t,n,o,s,i);if(a<c.value.g){c.value.g=a,c.value.f=l,c.value.parent=h;const e=r.findIndex((e=>e.value.x===n&&e.value.y===o));r.moveUp(e)}}else{const e=D(a,l,n,o,s,i);e.parent=h,r.enqueue(e)}}}return null},b=[[-1,0,c.UP],[0,1,c.RIGHT],[1,0,c.DOWN],[0,-1,c.LEFT]];let A=0;const H=new class{loopStatus=1;onLoop;lastTimeStamp;setOnLoop(e){this.onLoop=e}loop(e){const t=e-this.lastTimeStamp;this.lastTimeStamp=e,this.onLoop&&this.onLoop(t),window.requestAnimationFrame(this.loop.bind(this))}start(){1===this.loopStatus&&(this.loopStatus=0,this.lastTimeStamp=window.performance.now(),window.requestAnimationFrame(this.loop.bind(this)))}pause(){0===this.loopStatus&&(this.loopStatus=1)}stop(){2!==this.loopStatus&&(this.loopStatus=2)}},G=document.querySelector("#main-canvas"),C=document.querySelector("#status-bar"),F=document.querySelector("#tool-bar"),U=document.querySelector("#ctrl-bar"),M=document.querySelector("#tips-bar"),W=document.querySelector("#btn-pause"),q=document.querySelector("#btn-restart"),k=document.querySelector("#btn-ai"),B=document.querySelector("#btn-joystick-up"),z=document.querySelector("#btn-joystick-left"),Q=document.querySelector("#btn-joystick-right"),K=document.querySelector("#btn-joystick-down"),X=document.querySelector("#btn-dash");G.width=384,C.style.width=G.width+"px",U.style.width=G.width+"px",F.style.width=G.width+"px",M.style.width=G.width+"px",G.height=384,o()?U.classList.remove("hidden"):M.classList.remove("hidden");const Z=e=>{C.innerHTML=`Length: ${e}`},j=new class{constructor(e){this.canvas=e,this.ctx=e.getContext("2d")}clear(e){e?(this.ctx.save(),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawRect(e,t,s,i,n){const{ctx:r}=this;r.save(),r.fillStyle=n,r.fillRect(e,t,s,i),r.restore()}drawCircle(e,t,s,i){const{ctx:n}=this;n.save(),n.fillStyle=i,n.beginPath(),n.arc(e,t,s,0,2*Math.PI),n.fill(),n.restore()}drawText(e,t,s,i,n){const{ctx:r}=this;r.save(),r.textAlign="left",r.textBaseline="top",r.font=n,r.fillStyle=i,r.fillText(s,e,t),r.restore()}measureText(e,t){const{ctx:s}=this;s.save(),s.font=t;const i=s.measureText(e);return s.restore(),{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent}}}(G),V=new class extends n{constructor(e,t,s){super(e,t);const{width:i,height:n,text:r,textColor:o}=s;this.width=i,this.height=n,this.text=r,this.textColor=o||"White",this.font=n/5+"px sans-serif"}draw(e){e.drawRect(this.x,this.y,this.width,this.height,"#8fbc8fcc");const{width:t}=e.measureText(this.text,this.font);e.drawText(this.x+(this.width-t)/2,this.y+this.height/5*2,this.text,this.textColor,this.font)}}(0,96,{width:384,height:192,text:""});V.visible=!1;const $=new class extends n{constructor(e){const{x:t,y:s,rowNums:i,colNums:n,pixelSize:o}=e;super(t,s),this.rowNums=i,this.colNums=n,this.pixelSize=o,this._treeTypeArr=Array(2*i+2*n+4);for(let e=0;e<this._treeTypeArr.length;e++)this._treeTypeArr[e]=["TREE","OAK"][r(0,2)]}update(){}draw(e){this._drawTrees(e)}_drawCell(e,t,s,i){const n=l[i],{pixelSize:r}=this,{x:o,y:c}=h(t,s,r);for(let t=0;t<n.length;t++)for(let s=0;s<n[t].length;s++)0!==n[t][s]&&e.drawRect(o+s*r,c+t*r,r,r,a[n[t][s]])}_drawTrees(e){let t=0;for(let s=0;s<this.rowNums+2;++s)this._drawCell(e,0,s,this._treeTypeArr[t++]),this._drawCell(e,this.colNums+1,s,this._treeTypeArr[t++]);for(let s=1;s<=this.colNums;++s)this._drawCell(e,s,0,this._treeTypeArr[t++]),this._drawCell(e,s,this.colNums+1,this._treeTypeArr[t++])}}({x:0,y:0,rowNums:10,colNums:10,pixelSize:4});let J=new y({length:3,rowNums:10,colNums:10,pixelSize:4});J.onStatusChanged(Z),Z(J.length,J.speed);const ee=()=>{let e,t;do{e=r(0,$.colNums)+1,t=r(0,$.rowNums)+1}while(J.includes(e,t));return[e,t]},te=new class extends n{constructor(e,t,s,i){super(e,t),this.pixelSize=s,this.type=i}update(){}draw(e){const{pixelSize:t,type:s}=this,i=g[s],{x:n,y:r}=h(this.x,this.y,t);for(let s=0;s<i.length;s++)for(let o=0;o<i[s].length;o++)0!==i[s][o]&&e.drawRect(n+o*t,r+s*t,t,t,S[i[s][o]])}}(...ee(),4,1),se=e=>{const{isTailAccessible:t}=e;return((e,t,s,i)=>{A++>16&&((e=>{for(let t=0;t<e.length;t++){const s=r(0,e.length);[e[t],e[s]]=[e[s],e[t]]}})(b),A=0);const n=((e,t,s)=>{const{rowNums:i,colNums:n}=e,r=Array(i+2);for(let e=0;e<i+2;e++)r[e]=Array(n+2),0===e||e===i+1?r[e].fill(1):(r[e].fill(0),r[e][0]=r[e][n+1]=1);t.forEach((e=>{r[e.y][e.x]=1}));const{x:o,y:h}=t.getTail();return r[h][o]=0,r[s.y][s.x]=0,r})(e,t,s),o=((e,t,s,i,n)=>{const{x:r,y:o}=t,{x:h,y:a}=s,{x:l,y:c}=i,d=b.map((([e,t,s])=>({x:r+t,y:o+e,dir:s,tailPathLen:-1,foodPathLen:-1})));return d.forEach((t=>{if(t.x<0||t.y<0||t.x>=e.length||t.y>=e[0].length||1===e[t.y][t.x])return;if(!n&&t.x===h&&t.y===a)return;const s=R(t.x,t.y,h,a,e);s&&(t.tailPathLen=s.length-1);const i=R(t.x,t.y,l,c,e);i&&(t.foodPathLen=i.length-1)})),d})(n,t.getHead(),t.getTail(),s,i).filter((e=>-1!==e.tailPathLen));if(t.length!==e.colNums*e.rowNums-1){if(0===o.length)return[c.UP,c.RIGHT,c.DOWN,c.LEFT].filter((e=>e!==d[t.direction]))[r(0,3)];{let s,i,h;const a=o.filter((e=>-1!==e.tailPathLen));for(const e of a)e.dir===t.direction&&(s=e),-1!==e.foodPathLen&&(!i||e.foodPathLen<i.foodPathLen)&&(i=e),-1!==e.tailPathLen&&(!h||e.tailPathLen>h.tailPathLen)&&(h=e);let l;return l=s?s===i?s.dir:h&&t.length>e.colNums*e.rowNums/2?h.dir:i&&i.foodPathLen<=n.length/2?i.dir:s.dir:h?h.dir:i?i.dir:a[r(0,a.length-1)].dir,l}}{const e=o.find((e=>e.x===s.x&&e.y===s.y));if(e)return e.dir}})($,J,te,t)},ie=new i("KeyW"),ne=new i("KeyD"),re=new i("KeyS"),oe=new i("KeyA"),he=new i("ArrowUp"),ae=new i("ArrowRight"),le=new i("ArrowLeft"),ce=new i("ArrowDown"),de=new i("Space");B.addEventListener("mousedown",(()=>{J.changeDirection(c.UP)})),B.addEventListener("touchstart",(()=>{J.changeDirection(c.UP)})),Q.addEventListener("mousedown",(()=>{J.changeDirection(c.RIGHT)})),Q.addEventListener("touchstart",(()=>{J.changeDirection(c.RIGHT)})),K.addEventListener("mousedown",(()=>{J.changeDirection(c.DOWN)})),K.addEventListener("touchstart",(()=>{J.changeDirection(c.DOWN)})),z.addEventListener("mousedown",(()=>{J.changeDirection(c.LEFT)})),z.addEventListener("touchstart",(()=>{J.changeDirection(c.LEFT)})),X.addEventListener("mousedown",(()=>{J.dash()})),X.addEventListener("touchstart",(()=>{J.dash()}));let ue=!1,Te=!1;q.addEventListener("click",(()=>{J=new y({length:3,rowNums:10,colNums:10,pixelSize:4}),J.onStatusChanged(Z),Z(J.length,J.speed),[te.x,te.y]=ee(),te.type=[0,1,2,3][r(0,4)],te.visible=!0,Te&&(J.beforeMove=se),V.text="",V.visible=!1,W.removeAttribute("disabled"),q.blur()})),W.addEventListener("click",(()=>{ue=!ue,ue?(q.setAttribute("disabled","disabled"),W.innerHTML="Resume",V.text="Paused",V.textColor="White",V.visible=!0):(q.removeAttribute("disabled"),W.innerHTML="Pause",V.text="",V.visible=!1),W.blur()})),k.addEventListener("click",(()=>{Te=!Te,Te?(J.beforeMove=se,k.classList.add("btn-ctrl-enable")):(J.beforeMove=null,k.classList.remove("btn-ctrl-enable")),k.blur()})),H.setOnLoop((e=>{ue||(ie.isPressed()||he.isPressed()?J.changeDirection(c.UP):ne.isPressed()||ae.isPressed()?J.changeDirection(c.RIGHT):re.isPressed()||ce.isPressed()?J.changeDirection(c.DOWN):oe.isPressed()||le.isPressed()?J.changeDirection(c.LEFT):de.isPressed()&&J.dash(),(e=>{$.update(),te.update(),100===J.length?"You Win!"!==V.text&&(V.text="You Win!",V.textColor="Green",V.visible=!0):J.isDead()?(W.setAttribute("disabled","disabled"),"YOU DIED"!==V.text&&(V.text="YOU DIED",V.textColor="Red",V.visible=!0)):(J.update(e),J.isEat(te)&&(J.grow(),J.speedUp(),J.length<100?([te.x,te.y]=ee(),te.type=[0,1,2,3][r(0,4)]):te.visible=!1))})(e)),j.clear("DarkSeaGreen"),$.visible&&$.draw(j),te.visible&&te.draw(j),J.visible&&J.draw(j),V.visible&&V.draw(j)})),H.start()})();
//# sourceMappingURL=bundle.7ca631396b557d85927c.js.map